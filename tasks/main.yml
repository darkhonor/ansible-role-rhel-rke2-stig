---
###############################################################################
# Filename: tasks/main.yml
# Role: ansible-role-rhel-rke2-stig
# Summary: Ansible Role tasks for RHEL RKE2 STIG compliance
# Last Updated: 23 Jan 2026
# Classification: UNCLASSIFIED
###############################################################################
###########################################################
# STIG ID: RHEL-09-611075    Group ID: V-258104
# Rule Title: RHEL 9 passwords for new users or password changes must have a 24
#   hours minimum password lifetime restriction in /etc/login.defs.
# Severity: CAT II
###########################################################
- name: RHEL-09-611075 | Ensure minimum password lifetime is 24 hours
  ansible.builtin.lineinfile:
    path: /etc/login.defs
    regexp: '^\s*#*\s*PASS_MIN_DAYS\s+'
    line: 'PASS_MIN_DAYS 1'
    state: present
  tags:
    - RHEL-09-611075
    - CAT II

###########################################################
# STIG IDs: RHEL-09-654010 through RHEL-09-654255
# Group IDs: V-258176 through V-258225
# Rule Title: Deploy all STIG-required audit rules for system call
#   monitoring, privileged command execution, and identity file changes.
#   This template covers 50 individual STIG audit requirements.
# Severity: CAT II
###########################################################
- name: RHEL-09-654xxx | Deploy STIG audit rules
  ansible.builtin.template:
    src: 20-stig.rules.j2
    dest: /etc/audit/rules.d/20-stig.rules
    owner: root
    group: root
    mode: '0640'
  notify: Reload auditd rules
  tags:
    - RHEL-09-654010
    - audit
    - CAT II

###########################################################
# STIG IDs: RHEL-09-213045, RHEL-09-213050, RHEL-09-213055,
#   RHEL-09-213060, RHEL-09-213065, RHEL-09-231195, RHEL-09-291010,
#   RHEL-09-291035
# Group IDs: V-257804 through V-257808, V-257880, V-258034, V-258039
# Rule Title: Deploy kernel module blacklist to disable unnecessary and
#   potentially dangerous kernel modules (ATM, CAN, FireWire, SCTP, TIPC,
#   cramfs, USB storage, Bluetooth). Covers 8 STIG requirements.
# Severity: CAT II / CAT III
###########################################################
- name: RHEL-09-213xxx | Deploy kernel module blacklist
  ansible.builtin.template:
    src: blacklist.conf.j2
    dest: /etc/modprobe.d/blacklist.conf
    owner: root
    group: root
    mode: '0644'
  tags:
    - RHEL-09-213045
    - kernel
    - CAT II

